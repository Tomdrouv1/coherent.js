name: Welcome New Contributors

on:
  issues:
    types: [opened]
  pull_request_target:
    types: [opened]

jobs:
  welcome:
    runs-on: ubuntu-latest
    steps:
      - name: Welcome new contributors
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const issue = context.payload.issue || context.payload.pull_request;
            const user = issue.user.login;
            
            // Check if user has contributed before
            const query = `
              query($owner: String!, $name: String!, $author: String!) {
                repository(owner: $owner, name: $name) {
                  issues(first: 1, author: $author) {
                    totalCount
                  }
                  pullRequests(first: 1, author: $author) {
                    totalCount
                  }
                }
              }
            `;
            
            const variables = {
              owner: context.repo.owner,
              name: context.repo.repo,
              author: user
            };
            
            const result = await github.graphql(query, variables);
            const isFirstIssue = result.repository.issues.totalCount === 0;
            const isFirstPR = result.repository.pullRequests.totalCount === 0;
            
            if (isFirstIssue || isFirstPR) {
              const comment = [
                `Hello @${user}! ðŸ‘‹`,
                '',
                'Thank you for your first contribution to Coherent.js! ðŸŽ‰',
                '',
                "We're excited to have you as part of our community. Here are a few things that might help you get started:",
                '',
                '- Make sure to check out our [Contributing Guide](https://github.com/Tomdrouv1/coherent.js/blob/main/CONTRIBUTING.md)',
                '- If you have not already, please review our [Code of Conduct](https://github.com/Tomdrouv1/coherent.js/blob/main/CODE_OF_CONDUCT.md)',
                '- For help, feel free to ask questions in [Discussions](https://github.com/Tomdrouv1/coherent.js/discussions)',
                '- Check out our [Support Guide](https://github.com/Tomdrouv1/coherent.js/blob/main/SUPPORT.md) if you need assistance',
                '',
                'A maintainer will review your contribution soon. Thanks again for helping to make Coherent.js better! ðŸš€'
              ].join('\n');

              await github.rest.issues.createComment({
                issue_number: issue.number,
                owner: context.repo.owner,
                repo: context.repo.repo,
                body: comment
              });
            }
